<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Deck Completion Stats</title>
<link rel="stylesheet" href="app.css" />
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1"></script>
</head>
<body>
  <div class="layout-header">
    <h1>Deck Completion Stats</h1>
    <div id="streakContainer" class="streak-flame" style="display:none;">
      <div class="flame-core"></div>
      <div class="streak-num" id="streakDays">0</div>
      <div class="streak-label">DAY STREAK</div>
    </div>
  </div>

  <div class="settings-wrapper">
    <div class="card settings-card fancy">
      <div class="settings-lines">
        <div class="setting-line" id="deckLine">Current deck: <span id="currentDeck" class="interactive" onclick="selectDeck()">(All Decks)</span> <span id="deckCount" class="muted"></span></div>
        <div class="setting-line" id="modelLine">Current model: <span id="currentModel" class="interactive" onclick="selectModel()">(Any Model)</span></div>
        <div class="setting-line" id="wordFieldLine" style="display:none;">Word field: <span id="wordFieldName" class="interactive" onclick="selectWordField()"></span></div>
      </div>
    </div>
  </div>

  <div class="cards-container single-column">
    <div class="card">
      <h2 class="card-title">Progress</h2>
      <div class="card-desc">Overall studied cards over time. Shows how your total grows each period and (optional) projected finish.</div>
      <canvas id="statsChart" class="chart-canvas"></canvas>
      <label class="forecast-toggle below"><input type="checkbox" id="forecastToggle" onchange="toggleForecast(this.checked)"> Show forecast</label>
      <div id="forecastSummaries" class="forecast-summaries" style="display:none;"></div>
    </div>

    <div class="card" id="statusSection" style="display:none;">
      <h2 class="card-title">Status</h2>
      <div class="card-desc">Snapshot of current card states (New / Learning / Review) for each card type.</div>
      <div id="statusCharts" class="status-charts"></div>
    </div>

    <div class="card" id="milestonesSection" style="display:none;">
      <h2 class="card-title">Milestones</h2>
      <div class="card-desc">Key count goals already reached and projected future ones.</div>
      <div id="milestonesContent" class="milestones-grid"></div>
    </div>

    <div class="card" id="learningHistorySection">
      <h2 class="card-title">Learning History</h2>
      <div class="card-desc">New cards first studied in each period (stacked when multiple types).</div>
      <canvas id="learningHistoryChart" class="chart-canvas"></canvas>
    </div>

    <div class="card" id="timeStudiedSection" style="display:none;">
      <h2 class="card-title">Time Studied</h2>
      <div class="card-desc">Total study time spent each period (stacked). Values are seconds aggregated across reviews.</div>
      <canvas id="timeStudiedChart" class="chart-canvas"></canvas>
      <div id="timeStudiedSummary" class="inline-note"></div>
    </div>

    <div class="card" id="timeSpentSection">
      <h2 class="card-title">Time Spent on Card</h2>
      <div class="card-desc">Distribution of total study time per card (seconds grouped in 15s ranges) for each card type.</div>
      <div id="timeSpentCharts" class="time-histograms"></div>
      <div id="timeSpentTables" class="table-wrap"></div>
    </div>

    <div class="card" id="difficultSection">
      <h2 class="card-title">Most Difficult Cards</h2>
      <div class="card-desc">Cards with the highest wrong answer counts recently.</div>
      <div id="difficultTables" class="table-wrap"></div>
    </div>
  </div>

  <div class="foot">Made by Jacob Zhang</div>

  <!-- Floating pill with granularity + template selection (stacked rows) -->
  <div id="floatingControls" class="floating-pill vertical">
    <div class="pill-toggle" onclick="togglePill()" title="Collapse / Expand"></div>
    <div class="pill-content">
      <div class="pill-group">
        <div class="pill-label">Granularity</div>
        <div id="granularityRadios" class="pill-granularity">
          <label class="granularity-radio"><input type="radio" name="granularity" value="days" onchange="changeGranularity(this.value)">Days</label>
          <label class="granularity-radio"><input type="radio" name="granularity" value="weeks" onchange="changeGranularity(this.value)">Weeks</label>
          <label class="granularity-radio"><input type="radio" name="granularity" value="months" onchange="changeGranularity(this.value)">Months</label>
          <label class="granularity-radio"><input type="radio" name="granularity" value="quarters" onchange="changeGranularity(this.value)">Quarters</label>
          <label class="granularity-radio"><input type="radio" name="granularity" value="years" onchange="changeGranularity(this.value)">Years</label>
        </div>
      </div>
      <div class="pill-group templates-group">
        <div class="pill-label">Templates</div>
        <div id="modelTemplates" class="templates-wrap"></div>
      </div>
    </div>
  </div>
<script src="app.js"></script>
</body>
</html>
